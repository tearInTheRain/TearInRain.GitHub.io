---
title: 文档编辑器一
date: 2024-10-21 21:28:00 +0800
categories: [编程, 设计模式]
tags: [设计模式, 文档编辑器]     
description: 
---
## 介绍
通过介绍设计一个所见即所得的文档编辑器（Lexi）来介绍设计模式的实际应用

## 设计问题  
接下来将讨论以下7个设计问题：
1) **文档结构** &nbsp;如何组织文档内部的表示信息，这影响到文档的编辑，格式安排，文本分析等方面。比如文档内部信息全部放在一个数组，或者组织成一个树型结构，对文档其他部分的设计都有影响。  
2) **格式化** &nbsp;如何将文本和图形安排到行和列上。由于文档最终在用户面前是由行和列组成的，所以我们需要考虑行列和我们定义的文档结构如何交互。    
3) **修饰用户界面** &nbsp;比如滚动条、边界，如何灵活增加或去除修饰。    
4) **支持多种视感** &nbsp;视感就是看起来的风格，不同的操作系统的窗口都有各自的风格，希望不用做较大修改就能适应不同的风格。  
5) **支持多种窗口系统** &nbsp;Lex的设计应独立于窗口系统，这样才能在不同系统中迁移。    
6) **用户操作** &nbsp;用户操作分散应用的各个角落，如何提供对分散用户操作的统一控制，比如撤销操作。  
7) **拼写检查和连字符** &nbsp;灵活支持不同的分析操作。

通过以上介绍可以体会到一个思想，在设计时可以分为两个领域进行，首先是看不到的底层领域，即第一步规划的文档结构。第二步是看的到的高层领域，即第二步的格式化部分。这样的好处是文档结构和表示分离，格式化的时候不用考虑底层的字符、图片的细节。只用和文档结构抽象交互。有点类似于桥接模式。  

### 文档结构
底层领域的抽象需要匹配高层领域。在文档的例子中，高层领域由行、列、图形等部分组成。并且能一致的对待单个元素和组合元素。  
所以为所有对象定义个抽象类图元，子类包括基本元素（字符，图片）。也包括的结构元素（行，列）。这个图元提供接口用于添加或移除子图元。  

这就是组合模式，适用于任何复杂的层次结构。外面可以一致性的处理单个对象或复合对象。核心是单个对象和复合对象有同一个抽象接口。      
实现中可以新增一个抽象类让某类抽象具体化（比如Java的RuntimeException，专门抽象运行时异常）    

### 格式化
第一步的表示只是在程序，对象层面，可以类比为MarkDown语法。我们需要使用这个表示构造一个实际的，可以显示的物理结构，比如行列结构，同时关注显示的细节，比如边界宽度，缩进大小。相当于MarkDown语法如何被解析，渲染。  
由于我们希望可以运行时改变格式化算法，比如MarkDown文本在Github风格和VSCode风格中切换。这就要求将算法独立出来，封装成一个算法对象的层次结构，在运行时可以动态切换。这就是策略模式

### 修饰用户界面
>装饰模式需要接口匹配

使用组合，让边框组合图元
1) 选定组合候选对象  
2) 决定谁来组合谁。准则：被组合类修改会影响组合类；组合类能在被组合类前后执行操作。  

### 支持多种视感
>不同的功能即不同的子类
>动态替换子类需要使用抽象工厂模式
>限制是必须能抽象出公共产品类

图元的抽象子类明确了对具体某类图元的抽象，进一步的子类实现了不同风格的图元。

### 支持多种窗口系统
>桥接模式允许分离的类层次一起工作
>将功能分离到两个不同的类层次中

底层窗口系统绘制方式不兼容导致无法使用抽象工厂模式


### 用户操作

